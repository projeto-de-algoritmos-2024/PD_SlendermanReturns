"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[29096],{66870:(e,t,r)=>{r.d(t,{sV:()=>J,PQ:()=>O,kG:()=>U,k_:()=>z,lF:()=>F,KN:()=>I,yw:()=>Q,Mf:()=>$});var n=r(4253),i=r(5602),s=r(31035),o=r(72115),l=r(30974),a=r(91196),u=r(37811);let c=new URL("/rest/event",(0,o.Sv)());function d(){let e={};try{navigator.hardwareConcurrency&&(e.hardwareConcurrency=navigator.hardwareConcurrency);let t=new Float32Array(1),r=new Uint8Array(t.buffer);t[0]=1/0,t[0]=t[0]-t[0];let n=r[3];n&&(e.architecture=n),globalThis.screen.colorDepth&&(e.colorDepth=globalThis.screen.colorDepth),globalThis.screen.width&&globalThis.screen.height&&(e.screenSize="".concat(globalThis.screen.width,"x").concat(globalThis.screen.height))}catch(e){}return e}let m=d(),h=function(){var e,t,r;let n,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1?arguments[1]:void 0,a=Date.now(),u={...i,isStandaloneApp:!1,timestamp:a,isBrowserExtension:!1,timeZone:l.GI,isPro:(null==(e=null==o?void 0:o.user)?void 0:e.subscription_status)!=="none",userId:null==(t=null==o?void 0:o.user)?void 0:t.id,deviceInfo:m},c=globalThis.location.pathname+globalThis.location.search,h=!!getComputedStyle(document.documentElement).getPropertyValue("--arc-palette-title"),v=d(),g=s.A.get("pplx.visitor-id");return n=u.internalReferrer?u.internalReferrer:document.referrer,(globalThis.matchMedia("(display-mode: standalone)").matches||globalThis.matchMedia("(display-mode: minimal-ui)").matches||(null==(r=globalThis.navigator)?void 0:r.standalone))&&(u.isStandaloneApp=!0),{eventData:u,pathnameAndParams:c,visitorId:g,isArcBrowser:h,deviceInfo:v,referrer:n}};var v=r(35722),g=r(4725),p=r(5309),E=r(22655),f=r(9432),y=r(74060),w=r(29838),S=r(1016),b=r(37811);let T=0;class _{setOnce(){return -1==this.eventTime&&(this.eventTime=Date.now(),!0)}timeSinceTimestamp(e){return -1===this.eventTime||null===e?-1:this.eventTime<e?(a.v.log("TimeMarker.timeSinceTimestamp found inconsistency: mytime ".concat(this.eventTime,", old: ").concat(e)),-1):this.eventTime-e}timeBeforeTimestamp(e){return -1===this.eventTime||null===e?-1:this.eventTime>e?(a.v.log("TimeMarker.timeBeforeTimestamp found inconsistency: mytime ".concat(this.eventTime,", next: ").concat(e)),-1):e-this.eventTime}wasSet(){return -1!=this.eventTime}constructor(){(0,n._)(this,"eventTime",-1)}}let R={queryStr:null,queryParams:null,isFollowup:null,submissionCount:null,submissionType:null,frontendUUID:null,submitTimestamp:null,startFirstServerResponseMarker:null,startLLMTokenMarker:null,endStreamTimestamp:null,finalizedTimestamp:null,firstServerResponseReceived:!1,firstLLMTokenReceived:!1,firstSearchResultsMarker:null,isPerplexityBrowser:!1,browserVersion:null},P=null,k=(e,t,r)=>{var n,i,s,o,l,a,u;let c;let d=Date.now(),m={...e,timestamp:d,isBrowserExtension:!1,timeZone:null===(s=Intl)||void 0===s?void 0:null===(i=s.DateTimeFormat())||void 0===i?void 0:null===(n=i.resolvedOptions())||void 0===n?void 0:n.timeZone,isPerplexityBrowser:r};t&&(m.isPro=(null===(l=t.user)||void 0===l?void 0:l.subscription_status)&&(null===(a=t.user)||void 0===a?void 0:a.subscription_status)!=="none",m.userId=null==t?void 0:null===(u=t.user)||void 0===u?void 0:u.id);let h=window.location.pathname+window.location.search,g=!!getComputedStyle(document.documentElement).getPropertyValue("--arc-palette-title"),p=(0,v.NW)(),E=(0,w.cH)();return c=m.internalReferrer?m.internalReferrer:document.referrer,(window.matchMedia("(display-mode: standalone)").matches||window.matchMedia("(display-mode: minimal-ui)").matches||(null===(o=window.navigator)||void 0===o?void 0:o.standalone))&&(m.isStandaloneApp=!0),{eventData:m,pathnameAndParams:h,visitorId:E,isArcBrowser:g,deviceInfo:p,referrer:c}},C=[],L=null;function x(e){if(!C.length)return;let t=[...C];C=[],L&&(clearTimeout(L),L=null);try{if(!e)throw Error("Socket is not available");e.rawEmit("analytics_event",t)}catch(e){a.v.warn("[flushEventQueue] socket.emit failed, falling back to REST.",e),(0,p.$)(t).catch(e=>{a.v.warn("[flushEventQueue] REST fallback failed:",e)})}}let O=e=>{let{name:t,data:r,socket:n,session:i,isPerplexityBrowser:s,analyticsConfig:o={enabled:!1,batchSize:0,flushInterval:0}}=e,u=e=>{let{eventData:i,visitorId:u,pathnameAndParams:c,isArcBrowser:d,deviceInfo:m,referrer:h}=k(r,e,s);if(c.startsWith("/search/render"))return;b.env.NEXT_PUBLIC_EVENT_DEBUG_PRINT&&a.v.log("[_trackEvent] ".concat(t,": "),i);let v={event_name:t,event_data:i,visitor_id:u,url:c,referrer:h,language:(0,l.th)(),screen:"".concat(window.screen.width,"x").concat(window.screen.height),hostname:window.location.hostname,device_info:m,is_arc_browser:d};if(o.enabled)!function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5e3;C.push(e),C.length>=r?x(t):L||(L=setTimeout(()=>{x(t)},n))}(v,n,o.batchSize,o.flushInterval);else try{if(!n)throw Error("Socket is not available");n.emit("analytics_event",v)}catch(e){(0,p.$)(v)}};setTimeout(()=>u(i),0)},D=async e=>{let{name:t,data:r,socket:n,session:i,isPerplexityBrowser:s}=e,{eventData:o,visitorId:l,pathnameAndParams:u,isArcBrowser:c,deviceInfo:d,referrer:m}=k(r,i,s);if(!u.startsWith("/search/render"))return new Promise(e=>{b.env.NEXT_PUBLIC_EVENT_DEBUG_PRINT&&a.v.log("[_trackEventAsync] ".concat(t,": "),o);let r=setTimeout(()=>{e()},1e3),i={event_name:t,event_data:o,visitor_id:l,url:u,referrer:m,language:navigator.language,screen:"".concat(window.screen.width,"x").concat(window.screen.height),hostname:window.location.hostname,device_info:d,is_arc_browser:c};try{if(!n)throw Error("Socket is not available");n.emitWithAck("analytics_event",i).then(()=>{clearTimeout(r),e()}).catch(()=>{clearTimeout(r),e()})}catch(t){(0,p.$)(i).then(()=>{e()})}})},N=(e,t)=>{var r,n;if(!P||P.firstServerResponseReceived||!P.submitTimestamp||!(null===(r=P.startFirstServerResponseMarker)||void 0===r?void 0:r.setOnce()))return;P.firstServerResponseReceived=!0;let{queryStr:i,isFollowup:s,queryParams:o}=P,l=W();l>0&&O({name:"query first server response",data:{startFirstServerResponseElapsed:l,queryStr:i,isFollowup:s,mode:null!==(n=null==o?void 0:o.mode)&&void 0!==n?n:"unknown"},socket:e,session:t,isPerplexityBrowser:P.isPerplexityBrowser})},A=(e,t,r)=>{var n,i;if(!P||P.firstLLMTokenReceived||!r||!(null===(n=P.startLLMTokenMarker)||void 0===n?void 0:n.setOnce()))return;P.firstLLMTokenReceived=!0;let{queryStr:s,isFollowup:o,queryParams:l}=P,a=X();a>0&&O({name:"query first llm token",data:{startLLMTokenElapsed:a,queryStr:s,isFollowup:o,mode:null!==(i=null==l?void 0:l.mode)&&void 0!==i?i:"unknown"},socket:e,session:t,isPerplexityBrowser:P.isPerplexityBrowser})},M=(e,t)=>{var r;P&&t&&(null===(r=P.firstSearchResultsMarker)||void 0===r||r.setOnce())},I=(e,t)=>{try{(0,g.R)({submitQueryToBadSocket:{socketIsNull:e,socketIsDisconnected:t}})}catch(e){a.v.warn("Problem with reporting bad socket submit:",e)}},U=e=>{try{(0,g.R)({emptyReactQueryCacheErrorOnSearchPage:{isDefaultSearch:e}})}catch(e){a.v.warn("Problem with reporting bad socket submit:",e)}},z=e=>{try{(0,g.R)({socketConnectionTime:{elapsedTime:e}})}catch(e){a.v.warn("Problem with reporting socket timeout:",e)}},F=(e,t,r,n)=>{(0,g.R)({socketStreamingTime:{elapsedTime:e,isSchematized:t,isPro:r,isReasoning:n}})},B=(e,t,r)=>{r=null!=r?r:"unknown",(0,g.R)({startStreamElapsed:{elapsedMs:e,isFollowup:t,mode:r}})},V=(e,t,r)=>{r=null!=r?r:"unknown",(0,g.R)({startLLMTokenElapsed:{elapsedMs:e,isFollowup:t,mode:r}})},j=(e,t,r)=>{r=null!=r?r:"unknown",(0,g.R)({firstSearchResultElapsed:{elapsedMs:e,isFollowup:t,mode:r}})},H=(e,t,r)=>{(0,g.R)({startStreamHang:{isFollowup:e,numberOfEvents:r}})};class q{updateTimeout(){clearTimeout(this.timeoutForHangRequests),this.timeoutForHangRequests=null,this.timeoutForHangRequests=setTimeout(this.callback.bind(this),2e4)}keepTracking(){this.timeoutForHangRequests&&(++this.countEvents,this.updateTimeout())}stopTracking(){clearTimeout(this.timeoutForHangRequests),this.timeoutForHangRequests=null}callback(){this.stopTracking();let e=new Date;this.cb(e.getTime()-this.timerStarted.getTime(),this.countEvents)}constructor(e){(0,n._)(this,"timerStarted",void 0),(0,n._)(this,"timeoutForHangRequests",null),(0,n._)(this,"countEvents",0),(0,n._)(this,"cb",void 0),this.timerStarted=new Date,this.cb=e,this.updateTimeout()}}let G=null,K=(e,t,r,n)=>{var i,s,o;if(!P)return;P.finalizedTimestamp=Date.now();let l=-1;P.submitTimestamp&&(l=P.finalizedTimestamp-P.submitTimestamp);let a=W();a>0&&B(a,P.isFollowup,null==P?void 0:null===(i=P.queryParams)||void 0===i?void 0:i.mode);let u=Z();u>0&&j(u,P.isFollowup,null==P?void 0:null===(s=P.queryParams)||void 0===s?void 0:s.mode);let c=X();c>0&&V(c,P.isFollowup,null==P?void 0:null===(o=P.queryParams)||void 0===o?void 0:o.mode);let d=-1;P.endStreamTimestamp&&P.startFirstServerResponseMarker&&(d=P.startFirstServerResponseMarker.timeBeforeTimestamp(P.endStreamTimestamp));let m={...P,totalElapsed:l,startStreamElapsed:a,startFirstServerResponseElapsed:a,startLLMTokenElapsed:c,totalStreamingElapsed:d,submissionResult:e,entryUUID:null==t?void 0:t.backend_uuid,displayModel:null==t?void 0:t.display_model,stepType:null==t?void 0:t.step_type};O({name:"".concat(e," response"),data:m,socket:r,session:n,isPerplexityBrowser:P.isPerplexityBrowser})},W=()=>{var e,t;let r=-1;return P?r=null!==(t=null===(e=P.startFirstServerResponseMarker)||void 0===e?void 0:e.timeSinceTimestamp(P.submitTimestamp))&&void 0!==t?t:-1:r},X=()=>{var e,t;let r=-1;return P?r=null!==(t=null===(e=P.startLLMTokenMarker)||void 0===e?void 0:e.timeSinceTimestamp(P.submitTimestamp))&&void 0!==t?t:-1:r},Z=()=>{var e,t;let r=-1;return P?r=null!==(t=null===(e=P.firstSearchResultsMarker)||void 0===e?void 0:e.timeSinceTimestamp(P.submitTimestamp))&&void 0!==t?t:-1:r},J={submitQuery:e=>{let{name:t,queryStr:r,queryParams:n,isFollowup:i,frontendUUID:s,isPerplexityBrowser:o,socket:l,session:a,browserVersion:u}=e;T+=1,(P={...R}).submissionType=t,P.submitTimestamp=Date.now(),P.queryStr=r,P.queryParams=n,P.frontendUUID=s,P.submissionCount=T,P.isFollowup=i,P.startFirstServerResponseMarker=new _,P.firstSearchResultsMarker=new _,P.startLLMTokenMarker=new _,P.isPerplexityBrowser=o,P.browserVersion=u,O({name:"submit query",data:{...P},socket:l,session:a,isPerplexityBrowser:P.isPerplexityBrowser})},handleStreamProgress:(e,t,r,n)=>{N(e,t),M(e,n),A(e,t,r)},endStreamResponse:()=>{P&&null===P.endStreamTimestamp&&(P.endStreamTimestamp=Date.now())},failedResponse:(e,t,r)=>{K("FAILED",e,t,r)},successfulResponse:(e,t,r)=>{K("SUCCESSFUL",e,t,r)},startTrackingHangRequests:e=>{null==G||G.stopTracking(),G=new q((t,r)=>{H(e,t,r)})},keepTrackingHangRequests:()=>{null==G||G.keepTracking()},stopTrackingHangRequests:()=>{null==G||G.stopTracking()},getStartLLMTokenElapsed:X,getStartFirstServerResponseElapsed:W,getFirstSearchResultElapsed:Z,reportTakoWidgetRenderLatency:e=>{(0,g.R)({takoWidgetRenderLatency:{latency:e}})},reportAutosuggestLatencies:e=>{let{latencies:t,isMobile:r}=e;(0,g.R)({autosuggestLatency:{latencies:t,isMobile:r}})},reportConnectionEvent:e=>{(0,g.R)({connectionEvent:{event:e}})},reportClientContextSize:e=>{(0,g.R)({clientContextSize:{...e}})},reportClientPayload:(e,t,r)=>{(0,g.R)({clientPayload:{dbSize:e,perfDbQueryTimeMs:t,perfGetContextTimeMs:r}})}},Q=()=>{let e=(0,E.X)(),t=(0,S.N)(),r=(0,f.Z)(!1),n=!!(null==r?void 0:r.isInitialized),{initialized:s,getEppoJSONVariation:o}=(0,y.wn)(),l=(0,i.useMemo)(()=>{if(s)return o({flag:"batch-analytic-events",subjectType:"visitor_id",defaultValue:{enabled:!1,batchSize:0,flushInterval:0}})},[s,o]);return(0,i.useEffect)(()=>{let t=()=>{"hidden"===document.visibilityState&&C.length>0&&e&&x(e)},r=()=>{C.length>0&&e&&x(e)};return document.addEventListener("visibilitychange",t),window.addEventListener("pagehide",r),()=>{document.removeEventListener("visibilitychange",t),window.removeEventListener("pagehide",r),C.length>0&&e&&x(e)}},[e]),{trackEvent:(0,i.useCallback)((r,i,s)=>{O({name:r,data:i,socket:e,session:t,isPerplexityBrowser:n,analyticsConfig:l?{...l,enabled:null!=s?s:l.enabled}:void 0})},[e,t,l,n]),trackEventTyped:(0,i.useCallback)((r,i)=>O({name:r,data:i,socket:e,session:t,isPerplexityBrowser:n}),[e,t,n]),trackEventAsync:(0,i.useCallback)((r,i)=>D({name:r,data:i,socket:e,session:t,isPerplexityBrowser:n}),[e,t,n])}},$=()=>{let e=(0,S.N)()||void 0,t=(0,f.Z)(!1),r=!!(null==t?void 0:t.isInitialized);return{trackEvent:(0,i.useCallback)((t,n)=>{!function(e){var t;let{name:r,data:n,session:i}=e,{eventData:s,visitorId:o,pathnameAndParams:d,isArcBrowser:m,deviceInfo:v,referrer:g}=h(n,i);d.startsWith("/search/render")||(u.env.NEXT_PUBLIC_EVENT_DEBUG_PRINT&&a.v.log("[_trackEvent] ".concat(r,": "),s),t={event_name:r,event_data:s,visitor_id:null!=o?o:"",url:d,referrer:g,language:(0,l.th)(),screen:"".concat(globalThis.screen.width,"x").concat(globalThis.screen.height),hostname:globalThis.location.hostname,device_info:v,is_arc_browser:m},navigator.sendBeacon(c,new Blob([JSON.stringify(t)],{type:"application/json; charset=UTF-8"})))}({name:t,data:{...n||{},isPerplexityBrowser:r},session:e})},[e,r])}}},1016:(e,t,r)=>{r.d(t,{N:()=>s});var n=r(5602),i=r(74066);let s=()=>{let{data:e}=(0,i.useSession)(),t=(0,n.useRef)(e);return(0,n.useEffect)(()=>{var r,n,i;(null==e?void 0:null===(r=e.user)||void 0===r?void 0:r.id)!==(null===(i=t.current)||void 0===i?void 0:null===(n=i.user)||void 0===n?void 0:n.id)&&(t.current=e)},[e]),t.current}},22655:(e,t,r)=>{r.d(t,{AskSocketProvider:()=>m,X:()=>h});var n=r(60554),i=r(5602),s=r(92072),o=r(23172),l=r(91196),a=r(66870),u=r(96621),c=r(37811);let d=i.createContext(void 0),m=i.memo(e=>{let{children:t,withCredentials:r,isMweb:m=!1}=e,[h,v]=(0,i.useState)(void 0),g=(0,i.useRef)(!1),{setSocketStatus:p}=(0,o.t)(),E=(0,i.useRef)(0);return(0,i.useEffect)(()=>{let e=window.location.hostname.includes("localhost"),t=c.env.NEXT_PUBLIC_USE_TOKEN_AUTH_FOR_SOCKET,n=e?u.qB:void 0;c.env.NEXT_PUBLIC_GLOBAL_SOCKET_URL_OVERRIDE&&(n=c.env.NEXT_PUBLIC_GLOBAL_SOCKET_URL_OVERRIDE),n||l.v.info("No socket URL provided",{isLocalhost:e,useTokenAuth:t,socketUrlOverride:c.env.NEXT_PUBLIC_GLOBAL_SOCKET_URL_OVERRIDE,defaultClientSocketUrl:u.qB});let i=(null==n?void 0:n.startsWith("https://staging.i.perplexity.ai"))||(null==n?void 0:n.startsWith("https://testing.i.perplexity.ai")),o=!!c.env.NEXT_PUBLIC_FORCE_CREDENTIALS,a=r||o,d=null;if(e||t){let e={...(0,u.Gw)(),auth:e=>{(0,u.IU)().then(t=>{null===t?e({}):e({perplexity_jwt:t})})}};a&&(e.withCredentials=!0),i&&(e.transports=["websocket"]),v(d=(0,s.Ay)(n,e)),p("pending"),(0,u.f8)(d,m)}else{let e={...(0,u.Gw)()};a&&(e.withCredentials=!0),i&&(e.transports=["websocket"]),v(d=(0,s.Ay)(n,e)),p("pending"),(0,u.f8)(d,m)}return()=>{null==d||d.disconnect()}},[m,r,p]),(0,i.useEffect)(()=>{if(h)return h.on("connect",()=>{g.current?(p("reconnected"),a.sV.reportConnectionEvent("reconnected")):(p("connected"),g.current=!0,a.sV.reportConnectionEvent("connected"))}),h.on("disconnect",()=>{p("disconnected"),g.current=!0,a.sV.reportConnectionEvent("disconnected")}),h.on("connect_error",e=>{if(h.active);else if(l.v.error("Socket connection failed, retrying",e),E.current<3){let e=E.current;E.current+=1,setTimeout(()=>{h.connect()},Math.pow(2,1e3*e))}else p("error"),l.v.error("Reconnects failed, showing full reload toast",e)}),()=>{h.off("connect"),h.off("disconnect"),h.off("connect_error")}},[h,p,E]),(0,n.jsx)(d.Provider,{value:h,children:t})}),h=()=>(0,i.useContext)(d)},9432:(e,t,r)=>{r.d(t,{EntropyBrowserProvider:()=>E,Z:()=>f});var n=r(4253),i=r(60554),s=r(5602),o=r(49099),l=r(8482),a=r(52334),u=r(48958),c=r(97925),d=r(91196),m=r(98867);let h="mcjlamohcooanphmebaiigheeeoplihb",v="npclhjbddhklpbnacpjloidibaggcgon";class g{init(){if(this.initPromise)return;this.initPromise=this.send({type:"INIT"}),this.initPromise.then(()=>{this.isInitialized=!0}).catch(()=>{this.isInitialized=!1,(0,m.t)()}),this.initPromiseAgent=this.sendAgent({type:"INIT"}),this.initPromiseAgent.then(()=>{this.agentPort=e(v,"entropy_agent_"+(0,u.A)()),this.agentPort.onMessage.addListener(this.handleAgentMessage)}).catch(o.A);let e=(t,r)=>{let n=chrome.runtime.connect(t,{name:r});return n.onDisconnect.addListener(()=>{d.v.log("Disconnected. Attempting to reconnect..."),setTimeout(()=>{var n,i;let s=e(t,r);t===h?(null===(n=this.port)||void 0===n||n.onMessage.removeListener(this.handleMessage),s.onMessage.addListener(this.handleMessage),this.port=s):t===v&&(null===(i=this.agentPort)||void 0===i||i.onMessage.removeListener(this.handleAgentMessage),s.onMessage.addListener(this.handleAgentMessage),this.agentPort=s)},1e3)}),d.v.log("port",n),n};try{this.port=e(h,"entropy_client_context"),this.port.onMessage.addListener(this.handleMessage),this.agentPort=e(v,"entropy_agent_"+(0,u.A)()),this.agentPort.onMessage.addListener(this.handleAgentMessage)}catch(e){}}openNewTab(e){let t=new URL(e),r=new URLSearchParams(location.search);return r.set("erp",c.Q8.enum.tab),t.search=r.toString(),this.send({type:"OPEN_SIDECAR_IN_TAB",payload:{url:t}})}closeSideCar(){return this.send({type:"HIDE_SIDECAR"})}destroy(){var e,t,r,n;null===(e=this.port)||void 0===e||e.onMessage.removeListener(this.handleMessage),null===(t=this.port)||void 0===t||t.disconnect(),this.port=null,this.renderingPlace=null,null===(r=this.agentPort)||void 0===r||r.onMessage.removeListener(this.handleAgentMessage),null===(n=this.agentPort)||void 0===n||n.disconnect(),this.agentPort=null,this.messageHandlers.clear()}getSystemInfo(){if(this.initPromise||this.init(),!this.initPromise)throw Error("Failed to initialize Entropy browser adapter");return this.initPromise}getContext(e){return this.send({type:"GET_CONTEXT",payload:e})}injectSearchResults(e){return this.send({type:"NAV_SEARCH",payload:{query:e}})}getRenderingPlace(){return this.renderingPlace}subscribeRenderingPlace(e){this.emitter.on("UPDATE_RENDERING_PLACE",e)}getNavigationResults(){return this.navigationResults}resetNavigationResults(){this.navigationResults=null}subscribeNavigationResults(e){this.emitter.on("UPDATE_NAVIGATION_RESULTS",e)}subscribeToMessages(e){return this.messageHandlers.add(e),()=>{this.messageHandlers.delete(e)}}submitTask(e,t){var r;let n=e=>{if(d.v.log("submitTask message",e),"ok"===e.status&&e.content){var r,i;this.messageHandlers.delete(n),t(e.content,null!==(r=e.url)&&void 0!==r?r:"",null!==(i=e.extra_headers)&&void 0!==i?i:"")}};return null===(r=this.agentPort)||void 0===r||r.postMessage({action:"startAgentFromPerplexity",task:e.task,startURL:e.startURL,task_uuid:e.uuid,extra_headers:e.extra_headers}),this.subscribeToMessages(n)}async send(e){var t;if(!(null===(t=chrome)||void 0===t?void 0:t.runtime))throw Error("Chrome runtime not available");return new Promise((t,r)=>{chrome.runtime.sendMessage(h,e,e=>{if(chrome.runtime.lastError){r(chrome.runtime.lastError);return}t(e)})})}async sendAgent(e){var t;if(!(null===(t=chrome)||void 0===t?void 0:t.runtime))throw Error("Chrome runtime not available");return new Promise((t,r)=>{chrome.runtime.sendMessage(v,e,e=>{if(chrome.runtime.lastError){r(chrome.runtime.lastError);return}t(e)})})}constructor(){(0,n._)(this,"isInitialized",null),(0,n._)(this,"port",null),(0,n._)(this,"agentPort",null),(0,n._)(this,"initPromise",null),(0,n._)(this,"initPromiseAgent",null),(0,n._)(this,"renderingPlace",null),(0,n._)(this,"navigationResults",null),(0,n._)(this,"messageHandlers",new Set),(0,n._)(this,"emitter",(0,l.G)()),(0,n._)(this,"handleMessage",e=>{let t=c.E.safeParse(e);t.success&&(0,a.YW)(t.data).with({type:"UPDATE_RENDERING_PLACE"},e=>{this.renderingPlace=e.payload.place,this.emitter.emit("UPDATE_RENDERING_PLACE",this.renderingPlace)}).with({type:"UPDATE_NAVIGATION_RESULTS"},e=>{this.navigationResults=e.payload.results,this.emitter.emit("UPDATE_NAVIGATION_RESULTS",this.navigationResults)}).otherwise(e=>{d.v.warn("Unknown message type",e)})}),(0,n._)(this,"handleAgentMessage",e=>{for(let t of(d.v.log("handleAgentMessage",e),this.messageHandlers))t(e)})}}let p=(0,s.createContext)(null),E=e=>{let{children:t}=e,r=(0,s.useMemo)(()=>new g,[]),{onEntropyRenderingPlaceChange:n}=(0,m.y)();return(0,s.useEffect)(()=>(r.init(),r.subscribeRenderingPlace(e=>{n(e)}),()=>{r.destroy()}),[r,n]),(0,i.jsx)(p.Provider,{value:r,children:t})};function f(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],t=(0,s.useContext)(p);if(!t&&e)throw Error("useEntropyBrowser must be used inside EntropyBrowserProvider");return t}},98867:(e,t,r)=>{r.d(t,{EntropyStateProvider:()=>u,t:()=>a,y:()=>c});var n=r(60554),i=r(5602),s=r(91196),o=r(29838);let l=(0,i.createContext)({isEntropyBrowser:!1,onEntropyRenderingPlaceChange(){}});function a(e){try{e?(sessionStorage.setItem(o.yW,e),(0,o.TV)(o.yW,e)):sessionStorage.removeItem(o.yW)}catch(e){s.v.error("Error updating Entropy rendering place",e)}finally{}}function u(e){let{initialRenderingPlace:t,children:r}=e,[u,c]=(0,i.useState)(()=>{if(t)return t;try{let e=sessionStorage.getItem(o.yW);return null!=e?e:void 0}catch(e){if(e instanceof ReferenceError)return;s.v.error("Unable to store new rendering place",e);return}}),d=(0,i.useCallback)(e=>{c(e),a(e)},[]);return(0,n.jsx)(l.Provider,{value:{isEntropyBrowser:null!=u,onEntropyRenderingPlaceChange:d,entropyRenderingPlace:u},children:r})}function c(){let e=(0,i.useContext)(l);if(!e)throw Error("Unable to find <EntropyStateContext> in the component tree.");return e}},74060:(e,t,r)=>{r.d(t,{oW:()=>w,Hr:()=>E,wn:()=>S});var n=r(60554),i=r(5602),s=r(14513),o=r(64052),l=r(36624),a=r(21365),u=r(91196),c=r(66870),d=r(1016),m=r(29838),h=r(32195);let v=e=>!!e&&e.endsWith("@perplexity.ai");var g=r(22655),p=r(9432);let E=["pro-rewrite-banner-below-answer-add-detail-primary","pro-rewrite-banner-below-answer-see-more","pro-rewrite-banner-below-sources-primary","pro-rewrite-banner-below-sources-shopping-primary"],f=(0,i.createContext)({initialized:!1,getEppoJSONVariation:()=>({}),getEppoJSONNonExperimentFeatureFlag:()=>({}),getEppoStringVariation:()=>"",getEppoStringNonExperimentFeatureFlag:()=>"",getEppoBooleanVariation:()=>!1,getEppoBooleanNonExperimentFeatureFlag:()=>!1,getEppoNumericVariation:()=>0,getEppoNumericNonExperimentFeatureFlag:()=>0,keysRequiringRerender:[],addKeyRequiringRerender:()=>null,removeKeyRequiringRerender:()=>null}),y=(e,t,r,n,i)=>s=>(0,c.PQ)({name:"experiment assignment",data:{subjectType:s.subjectAttributes.subjectType,pagePropsHostname:i,colorScheme:n,...s},socket:e,session:t,isPerplexityBrowser:r}),w=e=>{var t,r,c;let{children:E,hostname:w}=e,S=(0,d.N)(),[b,T]=(0,i.useState)(!1),_=(0,s.useSearchParams)(),[R,P]=(0,i.useState)(!1),k=(0,m.cH)(),[C,L]=(0,i.useState)([]),x=(0,g.X)(),O=(0,p.Z)(!1),D=!!(null==O?void 0:O.isInitialized),{isProduction:N,isStaging:A}=(0,l.D)(),M=N||A?"Xt1y37LY9CvTrzAJsLSz8cLMtXN3IUEvJZHciWbO-OU":"GwM0spEq_mbseGAJ5OOouSj2OFUMOgsHV_mlozU75Zo",{colorScheme:I}=(0,a.U)();(0,i.useEffect)(()=>{x&&w&&!b&&(0,o.Ts)({apiKey:M,assignmentLogger:{logAssignment:y(x,S,D,I,w)}}).then(()=>{T(!0)})},[M,x,S,w,I,D,b]),(0,i.useEffect)(()=>{var e;!R&&_&&b&&(0,h.yZ)(null==S?void 0:null===(e=S.user)||void 0===e?void 0:e.email,_)&&P(!0)},[b,_,null==S?void 0:null===(t=S.user)||void 0===t?void 0:t.email,R]);let U=(0,i.useCallback)((e,t)=>{var r,n,i,s;let{flag:o,subjectType:l,defaultValue:a,extraAttributes:c}=t;if(!b)return a;let d="user_nextauth_id"===l?null==S?void 0:null===(r=S.user)||void 0===r?void 0:r.id:k;if(!d)return a;let{shouldUseOverride:m,value:g}=function(e){let{flag:t,override:r,defaultValue:n,email:i,isServer:s=!1}=e;if(!v(i)||!r)return{shouldUseOverride:!1,value:null};try{if("boolean"==typeof n)return{shouldUseOverride:!0,value:"true"===r};if("number"==typeof n)return{shouldUseOverride:!0,value:Number(r)};if("object"==typeof n)try{return{shouldUseOverride:!0,value:JSON.parse(r)}}catch(e){return u.v.warn("[Eppo ".concat(s?"Server ":"","Override]"),'Failed to parse JSON override for flag "'.concat(t,'"'),{override:r,error:e}),{shouldUseOverride:!0,value:n}}return{shouldUseOverride:!0,value:r}}catch(e){return u.v.error("[Eppo ".concat(s?"Server ":"","Override] Error:"),e),{shouldUseOverride:!0,value:n}}}({flag:o,override:(0,h.oJ)()[o],defaultValue:a,email:null==S?void 0:null===(n=S.user)||void 0===n?void 0:n.email});if(m)return null!=g?g:a;try{return e(d,o,{subjectType:l,visitorId:null!=k?k:void 0,userEmail:null!==(s=null==S?void 0:null===(i=S.user)||void 0===i?void 0:i.email)&&void 0!==s?s:void 0,...null!=c?c:{}},a)}catch(e){return u.v.error("[Eppo Experiments]","[".concat(o,"]"),Error("Error for key ".concat(d))),a}},[b,null==S?void 0:null===(r=S.user)||void 0===r?void 0:r.email,null==S?void 0:null===(c=S.user)||void 0===c?void 0:c.id,k]),z=(0,i.useCallback)(e=>U((e,t,r,n)=>(0,o.iE)().getJSONAssignment(t,e,r,n),e),[U]),F=(0,i.useCallback)(e=>U((e,t,r,n)=>(0,o.iE)().getStringAssignment(t,e,r,n),e),[U]),B=(0,i.useCallback)(e=>U((e,t,r,n)=>(0,o.iE)().getBooleanAssignment(t,e,r,n),e),[U]),V=(0,i.useCallback)(e=>U((e,t,r,n)=>(0,o.iE)().getNumericAssignment(t,e,r,n),e),[U]),j=(0,i.useCallback)(e=>{let{flag:t,defaultValue:r,extraAttributes:n}=e;return z({flag:t,subjectType:"visitor_id",defaultValue:r,extraAttributes:n})},[z]),H=(0,i.useCallback)(e=>{let{flag:t,defaultValue:r,extraAttributes:n}=e;return F({flag:t,subjectType:"visitor_id",defaultValue:r,extraAttributes:n})},[F]),q=(0,i.useCallback)(e=>{let{flag:t,defaultValue:r,extraAttributes:n}=e;return B({flag:t,subjectType:"visitor_id",defaultValue:r,extraAttributes:n})},[B]),G=(0,i.useCallback)(e=>{let{flag:t,defaultValue:r,extraAttributes:n}=e;return V({flag:t,subjectType:"visitor_id",defaultValue:r,extraAttributes:n})},[V]);return(0,n.jsx)(f.Provider,{value:{initialized:b,getEppoJSONVariation:z,getEppoJSONNonExperimentFeatureFlag:j,getEppoStringVariation:F,getEppoStringNonExperimentFeatureFlag:H,getEppoBooleanVariation:B,getEppoBooleanNonExperimentFeatureFlag:q,getEppoNumericVariation:V,getEppoNumericNonExperimentFeatureFlag:G,keysRequiringRerender:C,addKeyRequiringRerender:e=>{L(t=>t.includes(e)?t:[...t,e])},removeKeyRequiringRerender:e=>{L(t=>t.includes(e)?t.filter(t=>t!==e):t)}},children:E})},S=()=>{let e=(0,i.useContext)(f);if(!e)throw Error("useEppoExperiments must be used within EppoExperimentsContext");return e}},21365:(e,t,r)=>{r.d(t,{U:()=>s});var n=r(5602),i=r(65779);function s(e){let t=(0,n.useContext)(i.i);if(!t)throw Error("Attempted to access ColorSchemeContext from useColorScheme() without adding <ColorSchemeProvider> to the tree.");let[r,s]=(0,n.useState)(!t.isSystemColorScheme);(0,n.useEffect)(()=>{(null==e?void 0:e.addSecondPass)&&t.isSystemColorScheme&&!r&&s(!0)},[t.isSystemColorScheme,r,null==e?void 0:e.addSecondPass]);let o={...t};return(null==e?void 0:e.addSecondPass)&&(o.isColorSchemeReady=r),o}},43739:(e,t,r)=>{r.d(t,{L:()=>n});let n=(e,t)=>{let r=window.localStorage.getItem(e);return[r?JSON.parse(r):t,t=>{window.localStorage.setItem(e,JSON.stringify(t))}]}},28156:(e,t,r)=>{r.d(t,{d:()=>i});var n=r(5602);function i(e,t){(0,n.useEffect)(()=>{let r=window.cookieStore;if(!r)return;let n=r=>{let n=r.deleted.find(t=>t.name===e),i=r.changed.find(t=>t.name===e);if(n||i){t(null!=i?i:null);return}};return r.addEventListener("change",n),()=>{r.removeEventListener("change",n)}},[e,t])}},86237:(e,t,r)=>{r.d(t,{K:()=>s});var n=r(5602),i=r(58993);function s(e){(0,n.useEffect)(()=>{let t=window.matchMedia("(prefers-color-scheme: dark)");function r(){e(i.V.colorScheme)}return t.addEventListener("change",r),()=>{t.removeEventListener("change",r)}},[e])}},90703:(e,t,r)=>{r.d(t,{Q:()=>s});var n=r(5602),i=r(58993);function s(){return(0,n.useCallback)(()=>{let e="dark"===document.documentElement.dataset.colorScheme,t=i.V.colorScheme;e&&"light"===t?document.documentElement.dataset.colorScheme="light":e||"dark"!==t||(document.documentElement.dataset.colorScheme="dark")},[])}},65779:(e,t,r)=>{r.d(t,{S:()=>d,i:()=>c});var n=r(60554),i=r(5602),s=r(83352),o=r(28156),l=r(86237),a=r(90703),u=r(58993);let c=i.createContext(null);function d(e){let{children:t,userPreferredColorScheme:r}=e,[d,m]=(0,i.useState)(!r&&u.V.isSystemScheme),[h,v]=(0,i.useState)(null!=r?r:u.V.colorScheme),g=(0,i.useCallback)(e=>{u.V.userPreferredColorScheme=e,m(!1),v(e)},[]),p=(0,i.useCallback)(()=>{u.V.removeUserPreferredColorScheme(),m(!0),v(u.V.colorScheme)},[]),E=(0,a.Q)(),f=(0,i.useCallback)(e=>{d&&(v(e),E())},[d,E]);(0,l.K)(f);let y=(0,i.useMemo)(()=>s(()=>{let e=u.V.isSystemScheme;m(e),e||(v(u.V.colorScheme),E())},100),[E]);return(0,o.d)(u.V.PREFERRED_COLOR_SCHEME_COOKIE,y),(0,i.useEffect)(()=>{u.V.isSystemScheme&&(document.documentElement.dataset.colorScheme=u.V.colorScheme),E()},[E]),(0,n.jsx)(c.Provider,{value:{colorScheme:h,isSystemColorScheme:d,setSystemColorScheme:p,setUserPreferredColorScheme:g},children:t})}},36624:(e,t,r)=>{r.d(t,{D:()=>a,EnvProvider:()=>l});var n=r(60554),i=r(5602),s=r(36714);let o=i.createContext({isPublicDNS:!1,isLocalhost:!1,isPplxDev:!1,isPreview:!1,isStaging:!1,isBeta:!1,isTesting:!1,isAskDev:!1,isDevBox:!1,isNamedDevDomain:!1,isProduction:!1,isSandbox:!1,isDevDeployment:!1,envHasDevLogins:!1}),l=e=>{let{children:t,hostname:r}=e,i=(0,s._$)(r);return(0,n.jsx)(o.Provider,{value:{...i,envHasDevLogins:(0,s.zN)({...i})},children:t})},a=()=>{let e=i.useContext(o);if(!e)throw Error("useEnv must be used within EnvContext");return e}},23172:(e,t,r)=>{r.d(t,{V:()=>o,t:()=>l});var n=r(60554),i=r(5602);let s=i.createContext({socketStatus:"disconnected",failedToConnect:!1,setSocketStatus:()=>{}}),o=e=>{let{children:t}=e,[r,o]=i.useState("pending"),[l,a]=(0,i.useState)(!1);return(0,i.useEffect)(()=>{if("disconnected"===r){let e=setTimeout(a,3e3,!0);return()=>clearTimeout(e)}a("error"===r)},[r]),(0,n.jsx)(s.Provider,{value:{socketStatus:r,setSocketStatus:o,failedToConnect:l},children:t})},l=()=>{let e=i.useContext(s);if(!e)throw Error("useSocketStatus must be used within SocketStatusContext");return e}},97925:(e,t,r)=>{r.d(t,{E:()=>c,Q8:()=>o,hw:()=>l});var n=r(54815);let i=n.z.object({message:n.z.string(),url:n.z.string(),extra_headers:n.z.string()}),s=n.z.object({goal_id:n.z.string().nullable(),result:i});n.z.object({step_type:n.z.literal("ENTROPY_RESULTS"),content:s,uuid:n.z.string()});let o=n.z.enum(["new_tab","split_view","sidecar","tab"]),l=n.z.object({type:n.z.literal("UPDATE_RENDERING_PLACE"),payload:n.z.object({place:o})}),a=n.z.object({title:n.z.string(),url:n.z.string().url(),snippet:n.z.string(),domain:n.z.string().optional(),score:n.z.number().optional(),sitelinks:n.z.array(n.z.object({title:n.z.string(),url:n.z.string().url()})).optional()}),u=n.z.object({type:n.z.literal("UPDATE_NAVIGATION_RESULTS"),payload:n.z.object({results:n.z.array(a)})}),c=n.z.union([l,u])},58993:(e,t,r)=>{r.d(t,{V:()=>o});var n=r(31035),i=Object.defineProperty,s=(e,t,r)=>t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;class o{static get userPreferredColorScheme(){return n.A.get(this.PREFERRED_COLOR_SCHEME_COOKIE)}static set userPreferredColorScheme(e){n.A.set(this.PREFERRED_COLOR_SCHEME_COOKIE,e,{expires:400}),localStorage.setItem(this.PREFERRED_COLOR_SCHEME_COOKIE,e)}static removeUserPreferredColorScheme(){n.A.remove(this.PREFERRED_COLOR_SCHEME_COOKIE),localStorage.removeItem(this.PREFERRED_COLOR_SCHEME_COOKIE)}static get isSystemScheme(){return!0!=!!this.userPreferredColorScheme}static get colorScheme(){return this.isSystemScheme?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":this.userPreferredColorScheme}}((e,t,r)=>s(e,"symbol"!=typeof t?t+"":t,r))(o,"PREFERRED_COLOR_SCHEME_COOKIE","colorScheme")},35722:(e,t,r)=>{r.d(t,{EJ:()=>S,Gl:()=>h,LH:()=>E,Mp:()=>g,NW:()=>f,Qv:()=>p,ZV:()=>o,_G:()=>l,bN:()=>c,jP:()=>u,pc:()=>d,qi:()=>a,rW:()=>v});var n=r(48958),i=r(43739),s=r(49106);let o=e=>{let t=Number(e);return isNaN(t)?(console.log("formatNumber number failed on: ".concat(e)),"0"):t.toLocaleString("en-US")},l=()=>(0,n.A)(),a={status:"pending",uuid:l()},u=e=>e.some(e=>!s.i.isStatusPending(e)),c=(e,t,r)=>{if(e===t)return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;let n=Object.keys(e),i=Object.keys(t);return n.length==i.length&&n.every(n=>r?r(e[n],t[n]):e[n]===t[n])},d=(e,t)=>{let r=new URL(e);return r.searchParams.delete("source"),r.searchParams.delete("s"),t&&(r.hash=t),r.searchParams.sort(),r.href};function m(e){return e.charAt(0).toUpperCase()+e.slice(1)}function h(e,t){try{let r=new Date(e.replace(/-/g,"/")).toLocaleString(t,{weekday:"long",hour:"numeric",minute:"numeric",hour12:!0});return m(r)}catch(e){console.log(e)}return null}function v(e,t){let r=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].indexOf(e.toLowerCase());if(-1===r)return"";let n=new Date,i=new Date(n.setDate(n.getDate()-n.getDay()+r));return m(Intl.DateTimeFormat(t,{weekday:"short"}).format(i))}function g(e){return e.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:12})}function p(e,t,r){let n=new URL(e),i=n.searchParams;return i.set(t,r),n.search=i.toString(),n.toString()}let E=e=>{let t;if("string"==typeof e){if(isNaN(t=parseFloat(e)))throw Error("Invalid input: not a number")}else if("number"==typeof e)t=e;else throw Error("Invalid input: not a string or number");return t.toLocaleString("en-US")},f=()=>{let[e,t]=(0,i.L)("deviceInfo",{});if(0===Object.keys(e).length)try{navigator.hardwareConcurrency&&(e.hardwareConcurrency=navigator.hardwareConcurrency);let r=new Float32Array(1),n=new Uint8Array(r.buffer);r[0]=1/0,r[0]=r[0]-r[0];let i=n[3];i&&(e.architecture=i),window.screen.colorDepth&&(e.colorDepth=window.screen.colorDepth),window.screen.width&&window.screen.height&&(e.screenSize="".concat(window.screen.width,"x").concat(window.screen.height)),t(e)}catch(e){}return e},y=/\[(\d{1,2})(,\s*\{ts:\d+\})?\]/g,w=/(\n*^(("""+|'''+|```+)[A-Za-z0-9]*|#+ .*)$|^- |\*\*|\$\$|\||`|[-|]{3,})/gm;function S(e,t){let r=e.replace(w,"").replace(y,"").trim();if(r.length<=t)return r;{let e=r.slice(0,t).trim(),n=e.lastIndexOf(" ");return 2*n>t&&n<t-1?e.slice(0,n)+"...":e+"..."}}},36714:(e,t,r)=>{r.d(t,{CO:()=>g,FY:()=>d,KV:()=>v,Lp:()=>m,M8:()=>i,Vb:()=>a,YG:()=>l,Z$:()=>n,_$:()=>f,bU:()=>o,h5:()=>c,hZ:()=>p,jd:()=>h,ox:()=>s,zN:()=>E,zS:()=>u});let n=e=>null==e?void 0:e.includes("perplexity.ai"),i=e=>null==e?void 0:e.includes("localhost"),s=e=>null==e?void 0:e.includes("pplx.dev"),o=e=>n(e)&&(null==e?void 0:e.includes("preview")),l=e=>n(e)&&(null==e?void 0:e.includes("staging")),a=e=>n(e)&&((null==e?void 0:e.includes("alpha"))||(null==e?void 0:e.includes("beta"))),u=e=>n(e)&&(null==e?void 0:e.includes("testing")),c=e=>n(e)&&(null==e?void 0:e.includes("experimental")),d=e=>n(e)&&(null==e?void 0:e.includes("askdev")),m=e=>n(e)&&(null==e?void 0:e.startsWith("dev")),h=e=>n(e)&&((null==e?void 0:e.includes("klarna"))||(null==e?void 0:e.includes("inhouse"))||(null==e?void 0:e.includes("wolfram"))||(null==e?void 0:e.includes("ftrouter"))||(null==e?void 0:e.includes("ft"))||(null==e?void 0:e.includes("brave"))||(null==e?void 0:e.includes("claude2"))||(null==e?void 0:e.includes("claude1-instant"))||(null==e?void 0:e.includes("claude2-instant"))||(null==e?void 0:e.includes("shopping"))||(null==e?void 0:e.includes("turbo16k"))||(null==e?void 0:e.includes("yelp"))||(null==e?void 0:e.includes("mobile-flag-dev"))),v=e=>n(e)&&!o(e)&&!u(e)&&!a(e)&&!d(e)&&!m(e)&&!h(e)&&!c(e),g=e=>n(e)&&(null==e?void 0:e.includes("sandbox")),p=e=>(null==e?void 0:e.includes("quokka-gamma.ts.net"))||(null==e?void 0:e.endsWith(".preview.i.perplexity.ai")),E=e=>e.isTesting||e.isLocalhost||e.isSandbox||e.isDevBox||e.isPplxDev||e.isDevDeployment,f=e=>({isPublicDNS:n(e),isLocalhost:i(e),isPplxDev:s(e),isPreview:o(e),isStaging:l(e),isBeta:a(e),isTesting:u(e),isAskDev:d(e),isDevBox:m(e),isNamedDevDomain:h(e),isProduction:v(e),isSandbox:g(e),isDevDeployment:p(e)})}}]);
//# sourceMappingURL=29096-a75a86ac300ed0ee.js.map